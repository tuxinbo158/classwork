<%@ page contentType="text/html;charset=UTF-8" language="java"%>
<!--引用标签库，前缀设置为c-->
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<!DOCTYPE html>
<!-- 网页使用的语言 -->
<html lang="zh-CN">

	<head>
		<!-- 指定字符集 -->
		<meta charset="utf-8">
		<!-- 使用Edge最新的浏览器的渲染方式 -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- viewport视口：网页可以根据设置的宽度自动进行适配，在浏览器的内部虚拟一个容器，容器的宽度与设备的宽度相同。
    	width: 默认宽度与设备的宽度相同
    	initial-scale: 初始的缩放比，为1:1 -->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
		<title>用户信息管理系统</title>
		<!-- 1. 导入CSS的全局样式 -->
		<link href="./css/bootstrap.min.css" rel="stylesheet">
		<!-- 2. jQuery导入，建议使用1.9以上的版本 -->
		<script src="./js/jquery-3.3.1.js"></script>
		<!-- 3. 导入bootstrap的js文件 -->
		<script src="./js/bootstrap.min.js"></script>
		<style type="text/css">
			td,
			th {
				text-align: center;
			}
		</style>

	</head>

	<body>
		<div class="container">
			<h3 style="text-align: center">招聘信息列表</h3>
			<!--多条件查询表单-->
			<div style="float: left;">
				<!-- 多条件查询指定路径 -->
				<form class="form-inline" action="${pageContext.request.contextPath}/findUserByPageServlet" method="post" id="form1">
					<div class="form-group">
						<label for="exampleInput1">职位</label>
						<!-- 从condition的name数组中取出查询条件回显数据 -->
						<input type="text" name="jobname" value="${condition.jobname[0]}" class="form-control" id="exampleInput1" onblur="tsubmint()" placeholder="请輸入您期望的职业">
					</div>
					<div class="form-group">
						<label for="exampleInput2">公司名称</label>
						<select name="cpyname" class="form-control" id="exampleInput2" onchange="tsubmint()">
							<option value="">--选择公司--</option>
							<c:forEach items="${cpyname}" var="bestinfo">
								<option ${bestinfo.cpyname eq condition.cpyname[0] ? "selected": ""}>${bestinfo.cpyname}</option>
							</c:forEach>
						</select>
					</div>
					<div class="form-group">
						<label for="exampleInput3">学历</label>
						<select name="educationinfo" class="form-control" id="exampleInput3" onchange="tsubmint()">
							<option value="">--选择您的学历--</option>
							<c:forEach items="${education}" var="bestinfo">
								<option ${bestinfo.educationinfo eq condition.educationinfo[0] ? "selected": ""}>${bestinfo.educationinfo}</option>
							</c:forEach>
						</select>
					</div>
					<div class="form-group">
						<label for="exampleInput4">期望薪资</label>
						<input type="text" name="salary" value="${condition.salary[0]}" class="form-control" id="exampleInput4" onblur="tsubmint()" placeholder="请輸入整数金額（RMB）" onkeyup="tmoney()">
						<br><span id="tmoney"></span>
					</div>
				</form>
			</div>
			<!--招聘重点信息展示列表-->
			<table border="1" class="table table-bordered table-hover">
				<tr class="success">
					<th>公司名称</th>
					<th>岗位名称</th>
					<th>需求数量</th>
					<th>发布时间</th>
					<th>学历要求</th>
					<th>薪水</th>
					<th>操作</th>
				</tr>
				<!-- JSTL中forEach：items:容器对象；var:容器中元素的临时变量；varStatus:循环状态对象（通过状态调用index后台count）；index:容器中元素的索引，从0开始；count:循环次数，从1开始 -->
				<!-- ForEach User user ：list{}：items="${pb.list}"等价list；var="user"等价于 User user;varStatus循环执行次数-->
				<!-- EL表达式中* setter或getter方法，去掉set或get，在将剩余部分，首字母变为小写。 * setName -> Name -> name-->
				<c:forEach items="${pb.list}" var="req" varStatus="s">
					<tr>
						<td>${req.cpyname}</td>
						<td>${req.jobname}</td>
						<td>${req.reqnum}</td>
						<td>${req.reqtime}</td>
						<td>${req.educationinfo}</td>
						<td>${req.salary}</td>
						<!-- 将id信息随着链接跳转-->
						<td>
							<a class="btn btn-default btn-sm" href="${pageContext.request.contextPath}/findUserServlet?id=${user.id}">查看详情</a>&nbsp;
					</tr>
				</c:forEach>
			</table>
			<!--分页显示按钮与信息-->
			<div>
				<nav aria-label="Page navigation">
					<ul class="pagination">
						<!-- 当前页码为1时禁用（不能再点）；直接对li标签头进行设置 -->
						<c:if test="${pb.currentPage == 1}">
							<li class="disabled">
						</c:if>
						<c:if test="${pb.currentPage != 1}">
							<li>
						</c:if>
						<!-- 点击跳到当前页码上一页 -->
						<!-- 在所有与分页查询有关的路径上加上condition的回显数据，有则在转发回当前页面时会再一次回显，没有则回显空 -->
						<a href="${pageContext.request.contextPath}/findUserByPageServlet?currentPage=${pb.currentPage - 1}&rows=5&jobname=${condition.jobname[0]}&cpyname=${condition.cpyname[0]}&education=${condition.education[0]}&salary=${condition.salary[0]}" aria-label="Previous"> <span aria-hidden="true">&laquo;</span>
						</a>
						</li>
						<c:forEach begin="1" end="${pb.totalPage}" var="i">
							<!-- 如果页码编号和当前页码一样则加上"active"样式 -->
							<c:if test="${pb.currentPage == i}">
								<li class="active">
									<a href="${pageContext.request.contextPath}/findUserByPageServlet?currentPage=${i}&rows=5&jobname=${condition.jobname[0]}&cpyname=${condition.cpyname[0]}&education=${condition.education[0]}&salary=${condition.salary[0]}">${i}</a>
								</li>
							</c:if>
							<c:if test="${pb.currentPage != i}">
								<li>
									<a href="${pageContext.request.contextPath}/findUserByPageServlet?currentPage=${i}&rows=5&jobname=${condition.jobname[0]}&cpyname=${condition.cpyname[0]}&education=${condition.education[0]}&salary=${condition.salary[0]}">${i}</a>
								</li>
							</c:if>
						</c:forEach>
						<!-- 点击跳到当前页码下一页 -->
						<c:if test="${pb.currentPage == pb.totalPage}">
							<li class="disabled">
						</c:if>

						<c:if test="${pb.currentPage != pb.totalPage}">
							<li>
						</c:if>
						<a href="${pageContext.request.contextPath}/findUserByPageServlet?currentPage=${pb.currentPage + 1}&rows=5&jobname=${condition.jobname[0]}&cpyname=${condition.cpyname[0]}&education=${condition.education[0]}&salary=${condition.salary[0]}" aria-label="Next"> <span aria-hidden="true">&raquo;</span>
						</a>
						</li>
						<span style="font-size: 25px; margin-left: 5px;">
						共${pb.totalCount}条记录，共${pb.totalPage}页 </span>
					</ul>
				</nav>
			</div>
		</div>
		<script>
//			判断薪资输入格式
			function tmoney() {
				var value = $("#exampleInput4").val();
				var hint = document.getElementById("tmoney");
				if(/^\d*$/g.test(value)) {
					return true;
				} else {
					hint.innerHTML = "*请輸入整数金額（RMB）";
					hint.style.color = "red";
					return false;
				}
			}
//			所有信息正确后提交
			function tsubmint() {
				var flag = tmoney();
				if(flag) {
					$('#form1')[0].submit();
				} else {
					alert("你填写的薪资信息有错误，请认真核对！");
				}
			}
		</script>
	</body>